-- C:\xampp\mysql\data\resiliadata

-- Função para adcionar alunos de acordo com a tabela csv:
LOAD DATA INFILE 'C:/xampp/csv/CSV_aluno.csv'
REPLACE INTO TABLE aluno
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

LOAD DATA INFILE 'C:/xampp/csv/CSV_facilitador.csv'
REPLACE INTO TABLE facilitador
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

LOAD DATA INFILE 'C:/xampp/csv/CSV_monitor.csv'
REPLACE INTO TABLE monitor
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;



-- INSERINDO DADOS EM INSTITUIÇÃO
INSERT INTO instituicao (endereco, nome_unidade) VALUES
('Rua da Instituição, 123, Botafogo', 'Senac Botafogo'),
('Rua da Instituição, 661, Centro', 'Senac Centro'),
('Avenida da Escola, 456, Cinelandia', 'Senac Cinelandia');

--

INSERT INTO curso (id_curso, nome_curso, duracao, total_dias) VALUES
(1, 'Formação em Análise de Dados', '6 meses', 180),
(2, 'Segurança da Informação', '6 meses', 180),
(3, 'Sistemas Embarcados', '6 meses', 180),
(4, 'Gestão de Redes de Computadores', '6 meses', 180);


-- INSERINDO DADOS EM DISCIPLINA
INSERT INTO disciplina (nome) VALUES
('HardSkill'),
('SoftSkill');

--


INSERT INTO modulo (curso_fk, numero_modulo, qt_aula, carga_horaria, id_disciplina_fk)
VALUES
(1, 1, 22, 180, 1),
(1, 1, 14, 180, 2),
(1, 2, 22, 180, 1),
(1, 2, 14, 180, 2),
(1, 3, 22, 180, 1),
(1, 3, 14, 180, 2),
(1, 4, 22, 180, 1),
(1, 4, 14, 180, 2),
(1, 5, 22, 180, 1),
(1, 5, 14, 180, 2),

(2, 1, 22, 180, 1),
(2, 1, 14, 180, 2),
(2, 2, 22, 180, 1),
(2, 2, 14, 180, 2),
(2, 3, 22, 180, 1),
(2, 3, 14, 180, 2),
(2, 4, 22, 180, 1),
(2, 4, 14, 180, 2),
(2, 5, 22, 180, 1),
(2, 5, 14, 180, 2);


-- INSERINDO DADOS EM TURMA
INSERT INTO turma (curso_fk, sala) VALUES
(1, 101),
(2, 201),
(3, 301),
(4, 401);

-- 

INSERT INTO matricula (matricula, unidade_fk, id_curso_fk, id_turma_fk, status, cpf_aluno_fk)
VALUES
(1, 1, 1, 1, 'Ativa', 12345678901),
(2, 2, 1, 1, 'Ativa', 23456789012),
(3, 3, 1, 1, 'Ativa', 34567890123),
(4, 1, 2, 2, 'Ativa', 45678901234),
(5, 2, 2, 2, 'Ativa', 56789012345),
(6, 3, 2, 2, 'Ativa', 67890123456),
(7, 1, 3, 3, 'Ativa', 78901234567),
(8, 2, 2, 2, 'Ativa', 89012345678),
(9, 3, 3, 3, 'Ativa', 90123456789),
(10, 1, 1, 1, 'Ativa', 12345678909),
(11, 2, 3, 3, 'Ativa', 23456789098),
(12, 3, 2, 2, 'Ativa', 34567890187),
(13, 1, 2, 2, 'Ativa', 45678901276),
(14, 2, 1, 1, 'Ativa', 56789012365),
(15, 3, 1, 1, 'Ativa', 67890123454),
(16, 1, 3, 3, 'Ativa', 78901234543),
(17, 2, 2, 2, 'Ativa', 89012345632),
(18, 3, 3, 3, 'Ativa', 90123456721),
(19, 1, 1, 1, 'Ativa', 01234567890),
(20, 2, 3, 3, 'Ativa', 98765432101),

(21, 3, 1, 1, 'Ativa', 90123456789);

-- Inserção na tabela AULAS


INSERT INTO presenca_aluno_facilitador ( data, cpf_facilitador, matricula_aluno_fk, presenca_facilitador, modulo_fk)
VALUES
('2024-01-01', 56789012345, 1, 1, 1),
('2024-01-01', 56789012345, 2, 0, 1),
('2024-01-01', 56789012345, 3, 1, 1),

('2024-01-01', 56789012345, 4, 1, 11),
('2024-01-01', 56789012345, 5, 1, 11),
('2024-01-01', 56789012345, 6, 1, 11),

('2024-01-02', 45678901234, 1, 1, 2),
('2024-01-02', 45678901234, 2, 1, 2),
('2024-01-02', 45678901234, 3, 0, 2),

('2024-01-02', 67890123456, 4, 1, 12),
('2024-01-02', 67890123456, 5, 1, 12),
('2024-01-02', 67890123456, 6, 0, 12),

('2024-01-03', 56789012345, 1, 1, 1),
('2024-01-03', 56789012345, 2, 1, 1),
('2024-01-03', 56789012345, 3, 1, 1),

('2024-01-03', 56789012345, 4, 1, 11),
('2024-01-03', 56789012345, 5, 0, 11),
('2024-01-03', 56789012345, 6, 1, 11),

('2024-01-04', 45678901234, 1, 1, 2),
('2024-01-04', 45678901234, 2, 1, 2),
('2024-01-04', 45678901234, 3, 1, 2),

('2024-01-04', 67890123456, 4, 1, 12),
('2024-01-04', 67890123456, 5, 1, 12),
('2024-01-04', 67890123456, 6, 1, 12),

('2024-01-05', 56789012345, 1, 1, 1),
('2024-01-05', 56789012345, 2, 1, 1),
('2024-01-05', 56789012345, 3, 1, 1),

('2024-01-05', 56789012345, 4, 1, 11),
('2024-01-05', 56789012345, 5, 1, 11),
('2024-01-05', 56789012345, 6, 1, 11),

('2024-01-08', 56789012345, 1, 1, 1),
('2024-01-08', 56789012345, 2, 1, 1),
('2024-01-08', 56789012345, 3, 0, 1),

('2024-01-09', 45678901234, 1, 1, 2),
('2024-01-09', 45678901234, 2, 1, 2),
('2024-01-09', 45678901234, 3, 1, 2),

('2024-01-10', 56789012345, 1, 1, 1),
('2024-01-10', 56789012345, 2, 0, 1),
('2024-01-10', 56789012345, 3, 1, 1),

('2024-01-11', 45678901234, 1, 1, 2),
('2024-01-11', 45678901234, 2, 1, 2),
('2024-01-11', 45678901234, 3, 1, 2),

('2024-01-12', 56789012345, 1, 1, 1),
('2024-01-12', 56789012345, 2, 1, 1),
('2024-01-12', 56789012345, 3, 1, 1),

('2024-01-15', 56789012345, 1, 1, 1),
('2024-01-15', 56789012345, 2, 1, 1),
('2024-01-15', 56789012345, 3, 1, 1),

('2024-01-16', 45678901234, 1, 1, 2),
('2024-01-16', 45678901234, 2, 1, 2),
('2024-01-16', 45678901234, 3, 1, 2),

('2024-01-17', 56789012345, 1, 1, 1),
('2024-01-17', 56789012345, 2, 1, 1),
('2024-01-17', 56789012345, 3, 1, 1),

('2024-01-18', 45678901234, 1, 1, 2),
('2024-01-18', 45678901234, 2, 1, 2),
('2024-01-18', 45678901234, 3, 1, 2),

('2024-01-19', 56789012345, 1, 1, 1),
('2024-01-19', 56789012345, 2, 1, 1),
('2024-01-19', 56789012345, 3, 1, 1),

('2024-01-22', 56789012345, 1, 1, 1),
('2024-01-22', 56789012345, 2, 0, 1),
('2024-01-22', 56789012345, 3, 1, 1),

('2024-01-23', 45678901234, 1, 1, 2),
('2024-01-23', 45678901234, 2, 1, 2),
('2024-01-23', 45678901234, 3, 1, 2),

('2024-01-24', 56789012345, 1, 1, 1),
('2024-01-24', 56789012345, 2, 1, 1),
('2024-01-24', 56789012345, 3, 1, 1),

('2024-01-25', 45678901234, 1, 1, 2),
('2024-01-25', 45678901234, 2, 1, 2),
('2024-01-25', 45678901234, 3, 1, 2),

('2024-01-26', 56789012345, 1, 1, 1),
('2024-01-26', 56789012345, 2, 1, 1),
('2024-01-26', 56789012345, 3, 1, 1),

('2024-01-29', 56789012345, 1, 1, 1),
('2024-01-29', 56789012345, 2, 1, 1),
('2024-01-29', 56789012345, 3, 1, 1),

('2024-01-30', 45678901234, 1, 1, 2),
('2024-01-30', 45678901234, 2, 1, 2),
('2024-01-30', 45678901234, 3, 1, 2),

('2024-01-31', 56789012345, 1, 1, 1),
('2024-01-31', 56789012345, 2, 1, 1),
('2024-01-31', 56789012345, 3, 1, 1),

('2024-02-01', 45678901234, 1, 1, 2),
('2024-02-01', 45678901234, 2, 1, 2),
('2024-02-01', 45678901234, 3, 1, 2),

('2024-02-02', 56789012345, 1, 1, 1),
('2024-02-02', 56789012345, 2, 1, 1),
('2024-02-02', 56789012345, 3, 1, 1),

('2024-02-05', 56789012345, 1, 1, 1),
('2024-02-05', 56789012345, 2, 1, 1),
('2024-02-05', 56789012345, 3, 1, 1),

('2024-02-06', 45678901234, 1, 1, 2),
('2024-02-06', 45678901234, 2, 1, 2),
('2024-02-06', 45678901234, 3, 1, 2),

('2024-02-07', 56789012345, 1, 1, 1),
('2024-02-07', 56789012345, 2, 1, 1),
('2024-02-07', 56789012345, 3, 1, 1),

('2024-02-08', 45678901234, 1, 1, 2),
('2024-02-08', 45678901234, 2, 1, 2),
('2024-02-08', 45678901234, 3, 1, 2),

('2024-02-09', 56789012345, 1, 1, 1),
('2024-02-09', 56789012345, 2, 1, 1),
('2024-02-09', 56789012345, 3, 1, 1),

('2024-02-12', 56789012345, 1, 1, 1),
('2024-02-12', 56789012345, 2, 1, 1),
('2024-02-12', 56789012345, 3, 1, 1),

('2024-02-13', 45678901234, 1, 1, 2),
('2024-02-13', 45678901234, 2, 1, 2),
('2024-02-13', 45678901234, 3, 1, 2),

('2024-02-14', 56789012345, 1, 1, 1),
('2024-02-14', 56789012345, 2, 1, 1),
('2024-02-14', 56789012345, 3, 1, 1),

('2024-02-15', 45678901234, 1, 1, 2),
('2024-02-15', 45678901234, 2, 1, 2),
('2024-02-15', 45678901234, 3, 1, 2),

('2024-02-16', 56789012345, 1, 1, 1),
('2024-02-16', 56789012345, 2, 1, 1),
('2024-02-16', 56789012345, 3, 1, 1),

('2024-02-19', 56789012345, 1, 1, 1),
('2024-02-19', 56789012345, 2, 1, 1),
('2024-02-19', 56789012345, 3, 0, 1);


INSERT INTO presenca_aluno_monitor ( data, cpf_monitor, matricula_aluno_fk, presenca_monitor, modulo_fk)
VALUES
('2024-01-01', 10987654321, 1, 1, 1),
('2024-01-01', 10987654321, 2, 1, 1),
('2024-01-01', 10987654321, 3, 1, 1),

('2024-01-01', 32109876543, 4, 1, 11),
('2024-01-01', 32109876543, 5, 1, 11),
('2024-01-01', 32109876543, 6, 1, 11),

('2024-01-02', 21098765432, 1, 1, 2),
('2024-01-02', 21098765432, 2, 1, 2),
('2024-01-02', 21098765432, 3, 1, 2),

('2024-01-02', 32109876543, 4, 1, 12),
('2024-01-02', 32109876543, 5, 1, 12),
('2024-01-02', 32109876543, 6, 0, 12),

('2024-01-03', 10987654321, 1, 1, 1),
('2024-01-03', 10987654321, 2, 1, 1),
('2024-01-03', 10987654321, 3, 1, 1),

('2024-01-03', 32109876543, 4, 1, 11),
('2024-01-03', 32109876543, 5, 1, 11),
('2024-01-03', 32109876543, 6, 1, 11),

('2024-01-04', 21098765432, 1, 1, 2),
('2024-01-04', 21098765432, 2, 1, 2),
('2024-01-04', 21098765432, 3, 1, 2),

('2024-01-04', 32109876543, 4, 1, 12),
('2024-01-04', 32109876543, 5, 1, 12),
('2024-01-04', 32109876543, 6, 1, 12),

('2024-01-05', 10987654321, 1, 1, 1),
('2024-01-05', 10987654321, 2, 1, 1),
('2024-01-05', 10987654321, 3, 1, 1),

('2024-01-05', 32109876543, 4, 1, 11),
('2024-01-05', 32109876543, 5, 1, 11),
('2024-01-05', 32109876543, 6, 1, 11),

('2024-01-08', 10987654321, 1, 1, 1),
('2024-01-08', 10987654321, 2, 1, 1),
('2024-01-08', 10987654321, 3, 1, 1),

('2024-01-09', 21098765432, 1, 1, 2),
('2024-01-09', 21098765432, 2, 1, 2),
('2024-01-09', 21098765432, 3, 1, 2),

('2024-01-10', 10987654321, 1, 1, 1),
('2024-01-10', 10987654321, 2, 1, 1),
('2024-01-10', 10987654321, 3, 1, 1),

('2024-01-11', 21098765432, 1, 1, 2),
('2024-01-11', 21098765432, 2, 1, 2),
('2024-01-11', 21098765432, 3, 1, 2),

('2024-01-12', 10987654321, 1, 1, 1),
('2024-01-12', 10987654321, 2, 0, 1),
('2024-01-12', 10987654321, 3, 1, 1),

('2024-01-15', 10987654321, 1, 1, 1),
('2024-01-15', 10987654321, 2, 1, 1),
('2024-01-15', 10987654321, 3, 1, 1),

('2024-01-16', 21098765432, 1, 1, 2),
('2024-01-16', 21098765432, 2, 1, 2),
('2024-01-16', 21098765432, 3, 1, 2),

('2024-01-17', 10987654321, 1, 1, 1),
('2024-01-17', 10987654321, 2, 1, 1),
('2024-01-17', 10987654321, 3, 0, 1),

('2024-01-18', 21098765432, 1, 1, 2),
('2024-01-18', 21098765432, 2, 1, 2),
('2024-01-18', 21098765432, 3, 1, 2),

('2024-01-19', 10987654321, 1, 1, 1),
('2024-01-19', 10987654321, 2, 1, 1),
('2024-01-19', 10987654321, 3, 1, 1),

('2024-01-22', 10987654321, 1, 1, 1),
('2024-01-22', 10987654321, 2, 1, 1),
('2024-01-22', 10987654321, 3, 1, 1),

('2024-01-23', 21098765432, 1, 1, 2),
('2024-01-23', 21098765432, 2, 1, 2),
('2024-01-23', 21098765432, 3, 1, 2),

('2024-01-24', 10987654321, 1, 1, 1),
('2024-01-24', 10987654321, 2, 1, 1),
('2024-01-24', 10987654321, 3, 1, 1),

('2024-01-25', 21098765432, 1, 1, 2),
('2024-01-25', 21098765432, 2, 1, 2),
('2024-01-25', 21098765432, 3, 1, 2),

('2024-01-26', 10987654321, 1, 1, 1),
('2024-01-26', 10987654321, 2, 1, 1),
('2024-01-26', 10987654321, 3, 1, 1),

('2024-01-29', 10987654321, 1, 1, 1),
('2024-01-29', 10987654321, 2, 0, 1),
('2024-01-29', 10987654321, 3, 1, 1),

('2024-01-30', 21098765432, 1, 1, 2),
('2024-01-30', 21098765432, 2, 1, 2),
('2024-01-30', 21098765432, 3, 1, 2),

('2024-01-31', 10987654321, 1, 1, 1),
('2024-01-31', 10987654321, 2, 1, 1),
('2024-01-31', 10987654321, 3, 1, 1),

('2024-02-01', 21098765432, 1, 1, 2),
('2024-02-01', 21098765432, 2, 1, 2),
('2024-02-01', 21098765432, 3, 1, 2),

('2024-02-02', 10987654321, 1, 1, 1),
('2024-02-02', 10987654321, 2, 1, 1),
('2024-02-02', 10987654321, 3, 1, 1),

('2024-02-05', 10987654321, 1, 1, 1),
('2024-02-05', 10987654321, 2, 1, 1),
('2024-02-05', 10987654321, 3, 1, 1),

('2024-02-06', 21098765432, 1, 1, 2),
('2024-02-06', 21098765432, 2, 1, 2),
('2024-02-06', 21098765432, 3, 1, 2),

('2024-02-07', 10987654321, 1, 1, 1),
('2024-02-07', 10987654321, 2, 1, 1),
('2024-02-07', 10987654321, 3, 1, 1),

('2024-02-08', 21098765432, 1, 1, 2),
('2024-02-08', 21098765432, 2, 1, 2),
('2024-02-08', 21098765432, 3, 1, 2),

('2024-02-09', 10987654321, 1, 1, 1),
('2024-02-09', 10987654321, 2, 0, 1),
('2024-02-09', 10987654321, 3, 1, 1),

('2024-02-12', 10987654321, 1, 1, 1),
('2024-02-12', 10987654321, 2, 1, 1),
('2024-02-12', 10987654321, 3, 1, 1),

('2024-02-13', 21098765432, 1, 1, 2),
('2024-02-13', 21098765432, 2, 1, 2),
('2024-02-13', 21098765432, 3, 1, 2),

('2024-02-14', 10987654321, 1, 1, 1),
('2024-02-14', 10987654321, 2, 1, 1),
('2024-02-14', 10987654321, 3, 1, 1),

('2024-02-15', 21098765432, 1, 1, 2),
('2024-02-15', 21098765432, 2, 1, 2),
('2024-02-15', 21098765432, 3, 1, 2),

('2024-02-16', 10987654321, 1, 1, 1),
('2024-02-16', 10987654321, 2, 1, 1),
('2024-02-16', 10987654321, 3, 1, 1),

('2024-02-19', 10987654321, 1, 1, 1),
('2024-02-19', 10987654321, 2, 0, 1),
('2024-02-19', 10987654321, 3, 0, 1);


INSERT INTO presenca (
  matricula_aluno_fk,
  data,
  modulo_fk,
  id_aula_facilitador_fk,
  id_aula_monitor_fk,
  presenca_facilitador_fk,
  presenca_monitor_fk,
  presenca_modulo
)
SELECT
  paf.matricula_aluno_fk,
  paf.data,
  paf.modulo_fk,
  paf.id_aula_facilitador,
  pam.id_aula_monitor,
  paf.presenca_facilitador,
  pam.presenca_monitor,
  CASE WHEN paf.presenca_facilitador = 1 AND pam.presenca_monitor = 1 THEN 1 ELSE 0 END AS presenca_modulo
FROM
  presenca_aluno_facilitador paf
INNER JOIN
  presenca_aluno_monitor pam ON pam.id_aula_monitor = paf.id_aula_facilitador;

-- Visualizar os dados nas tabelas
SELECT * FROM presenca_aluno_monitor;
SELECT * FROM presenca_aluno_facilitador;
SELECT * FROM presenca;

-- Visualizar o total de presença
SELECT
  pa.matricula_aluno_fk,
  d.nome AS disciplina,
  m.numero_modulo,
  SUM(pa.presenca_modulo) AS total_presencas,
  COUNT(*) AS total_aulas
FROM
  presenca pa
INNER JOIN
  modulo m ON pa.modulo_fk = m.id_modulo
INNER JOIN
  disciplina d ON d.id_disciplina = m.id_disciplina_fk
GROUP BY
  pa.matricula_aluno_fk, m.numero_modulo, d.nome;

-- Isert da matricula

INSERT INTO avaliacao (matricula_aluno_fk, nota, status, total_presencas, id_modulo_fk)
VALUES
(1, 100, 'APROVADO', 22, 1),
(1, 100, 'APROVADO', 14, 2),
(2, 100, 'EVADIDO', 15, 1),
(2, 100, 'EVADIDO', 14, 2),
(3, 100, 'APROVADO', 19, 1),
(3, 100, 'APROVADO', 13, 2),

(4, 0, 'CANCELADO', 3, 11),
(4, 0, 'CANCELADO', 2, 12),
(5, 0, 'CANCELADO', 2, 11),
(5, 0, 'CANCELADO', 2, 12),
(6, 0, 'CANCELADO', 3, 11),
(6, 0, 'CANCELADO', 1, 12);

SELECT * FROM avaliacao;

UPDATE avaliacao SET status = 'REPROVADO' WHERE matricula_aluno_fk IN (4, 5, 6);
SELECT * FROM log_status_update;